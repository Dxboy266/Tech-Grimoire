# MySQL专栏写作规范

## 技术委员会

### 核心成员
- **Michael "Monty" Widenius (MySQL之父)**: 负责存储引擎、事务机制审查
- **丁奇 (阿里MySQL专家/《MySQL实战45讲》作者)**: 负责生产实战、性能优化审查  
- **姜承尧 (《MySQL技术内幕》作者)**: 负责技术深度、中文表达审查

### 分工机制
- **Monty**: 把关技术原理准确性，确保不误导读者（存储引擎、MVCC、日志体系）
- **丁奇**: 审查生产可用性，方案是否经得起实战验证（慢查询、死锁、主从复制）
- **姜承尧**: 检查技术深度和中文表达，避免翻译腔和AI腔（InnoDB内核、索引原理）

---

## 去AI化写作要求

### 禁用的AI味表达
```
❌ "在当今互联网时代"
❌ "随着业务的发展"
❌ "众所周知"
❌ "不难发现"
❌ "值得注意的是"
❌ "综上所述"
❌ "首先...其次...最后..."（机械式排比）
❌ "让我们来看看"
❌ "接下来我们将..."
```

### 推荐的人话表达
```
✅ 直接说问题："订单表查询慢，扫了200万行"
✅ 用数据说话："优化后QPS从800提到3200"
✅ 说人话："这个索引没用上，因为用了函数"
✅ 直接给结论："别在WHERE里用函数，会导致索引失效"
✅ 用口语化过渡："再看个例子" "问题来了" "怎么办"
```

### 段落风格要求
- 每段开头直接说重点，不铺垫
- 多用短句，少用长句
- 技术术语第一次出现时用括号解释，后续直接用
- 代码和文字穿插，不要大段堆砌

---

## MySQL专栏核心关注点

### 必讲技术点
1. **存储引擎**: InnoDB架构、Buffer Pool、Change Buffer
2. **事务**: ACID、隔离级别、MVCC、锁机制
3. **索引**: B+树、聚簇索引、覆盖索引、索引下推
4. **查询优化**: 执行计划、统计信息、优化器行为
5. **主从复制**: binlog、GTID、延迟问题
6. **性能调优**: 慢查询、参数配置、监控指标

### 性能指标标准
每个优化案例必须包含：
- **QPS/TPS**: 优化前后对比
- **响应时间**: P50/P95/P99
- **扫描行数**: EXPLAIN的rows字段
- **CPU/内存**: 资源占用变化
- **慢查询时间**: 具体到毫秒

### 典型场景库
- 电商订单表（分页查询、状态更新）
- 用户表（登录验证、信息查询）
- 商品库存表（高并发扣减）
- 日志表（大数据量写入、归档）
- 关联查询（订单+用户+商品）

---

## 写作铁律

### 1. 结构固定（5部分）
```markdown
## 这一讲解决什么问题
一句话 + 3个知识点 + 能做什么

## 核心内容
### 概念（一句话定义）
### 原理（配图 + 200字内）
### 实战（完整案例）
### 避坑（3-5个）

## 实战案例
**场景**: 具体业务场景
**问题**: 慢查询/死锁/主从延迟等
**分析**: EXPLAIN/SHOW命令输出
**方案**: 具体优化步骤
**效果**: 前后数据对比
**套路**: 可复用的方法论

## 避坑指南
⚠️ 坑点 + 错误示例 + 正确做法 + 原因

## 作业
基础题 + 进阶题 + 提交要求
```

### 2. 篇幅控制
- **目标**: 3500-4500字，阅读15-20分钟
- **硬上限**: 5000字（超了必须拆）
- **精简原则**: 
  - 删掉所有"众所周知""显而易见"
  - 一个概念不超过150字
  - 一个案例不超过500字
  - 能用表格就不用文字

### 3. 代码规范
```sql
-- ✅ 好的示例：有注释、有上下文、能直接运行
-- 创建订单表
CREATE TABLE orders (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  user_id BIGINT NOT NULL,
  status TINYINT NOT NULL DEFAULT 0, -- 0:待支付 1:已支付 2:已完成
  created_at DATETIME NOT NULL,
  INDEX idx_user_status (user_id, status)
) ENGINE=InnoDB;

-- 查询某用户的待支付订单
SELECT id, created_at 
FROM orders 
WHERE user_id = 10001 AND status = 0;

-- ❌ 差的示例：无注释、参数不明、无法运行
select * from t where a=1;
```

### 4. 可视化要求
每讲至少1个，标注清楚：

```markdown
<!-- 🎨 需要画图：B+树结构 -->
<!-- 📸 需要截图：EXPLAIN执行计划，标注type/key/rows -->
<!-- 📋 需要表格：隔离级别对比 -->
```

**图的质量标准**:
- 节点文字≤8个字
- 流程清晰，不超过12个节点
- 关键路径用颜色标注
- 必须配文字说明

---

## 内容合理性检查

### 技术准确性（Monty审查）
- [ ] SQL语法正确，能在MySQL 8.0运行
- [ ] 原理描述符合官方文档
- [ ] 存储引擎行为描述准确
- [ ] 事务/锁机制无误导

### 生产可用性（Jeremy审查）
- [ ] 性能数据真实（不能编造）
- [ ] 方案考虑了高并发场景
- [ ] 有回滚方案和风险提示
- [ ] 监控和排查手段完整
- [ ] 适用范围和限制明确

### 表达自然度（姜承尧审查）
- [ ] 无AI腔调（检查禁用词）
- [ ] 技术术语使用准确
- [ ] 中文表达流畅自然
- [ ] 代码注释清晰易懂
- [ ] 过渡自然，不生硬

---

## 常见坑点库（MySQL专用）

### 索引类
1. WHERE条件用了函数导致索引失效
2. 隐式类型转换导致全表扫描
3. 联合索引顺序不对
4. 索引区分度太低
5. 回表代价太高，优化器放弃索引

### 事务类
1. 长事务导致锁等待
2. 死锁场景（更新顺序不一致）
3. 隔离级别选择不当
4. 大事务导致主从延迟
5. 事务未提交占用连接

### 查询类
1. SELECT * 查询不必要字段
2. 深分页性能差（LIMIT 100000,10）
3. IN条件值过多
4. 子查询性能差
5. JOIN表过多

### 配置类
1. innodb_buffer_pool_size设置不当
2. max_connections过小
3. binlog未开启或格式不对
4. 慢查询阈值设置不合理
5. 连接池配置不当

---

## 写作流程（2小时完成）

### 第1步：定主题（10分钟）
```
1. 这一讲解决什么核心问题？（一句话）
2. 读者能学到哪3个知识点？
3. 准备什么实战案例？（真实场景）
4. 需要什么图？（架构图/流程图/对比表）
5. 有哪些坑要提醒？（至少3个）
```

### 第2步：写案例（40分钟）
先写实战案例，再补原理：
1. 描述业务场景（订单/用户/商品等）
2. 贴出问题SQL和EXPLAIN结果
3. 分析问题原因（索引/锁/配置等）
4. 给出优化方案（SQL改写/加索引/调参数）
5. 贴出优化后的数据对比
6. 总结可复用的套路

### 第3步：补原理（30分钟）
1. 一句话定义核心概念
2. 画图说明原理（B+树/MVCC/锁等）
3. 200字内讲清楚机制
4. 标注可视化需求（🎨📸📋）

### 第4步：整理避坑（20分钟）
1. 列出3-5个常见错误
2. 每个坑给出：错误示例 → 正确做法 → 原因
3. 补充监控和排查命令

### 第5步：自查（20分钟）
对照检查清单：
- [ ] 字数3500-5000？
- [ ] 结构完整？
- [ ] SQL能运行？
- [ ] 有性能数据？
- [ ] 有可视化标注？
- [ ] 无AI腔调？
- [ ] 技术准确？

---

## 质量红线（触碰重写）

🔴 **技术错误**: SQL语法错、原理错、数据造假
🔴 **不能运行**: SQL无法执行、步骤不清、缺少环境说明
🔴 **无性能数据**: 优化案例没有前后对比
🔴 **AI腔调重**: 出现3个以上禁用词
🔴 **结构残缺**: 缺案例/缺图/缺避坑/缺作业
🔴 **篇幅失控**: 超5000字或低于3000字

---

## 自查清单

### 开始写作前
- [ ] 确定了核心问题和3个知识点
- [ ] 准备了真实业务场景
- [ ] 列出了3-5个坑点
- [ ] 明确了需要的图表类型

### 写作过程中
- [ ] 每500字检查一次是否有AI腔
- [ ] 每个SQL都加了注释
- [ ] 每个优化都有数据对比
- [ ] 标注了可视化需求

### 完成后
- [ ] 字数在3500-5000之间
- [ ] SQL在MySQL 8.0能运行
- [ ] 无禁用词（AI腔）
- [ ] 有完整的实战案例
- [ ] 有性能数据对比
- [ ] 有可视化标注
- [ ] 有避坑指南
- [ ] 有作业

---

## 委员会寄语

**Monty**: "Keep it simple, keep it correct."  
**丁奇**: "生产环境见真章，数据说话。"  
**姜承尧**: "写给人看的，不是写给机器看的。"

**共识**: 每个字都要让读者离解决问题更近一步，每个案例都要能直接用到生产环境。
